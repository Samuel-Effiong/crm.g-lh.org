{% extends 'project_management/app/user-profile.html' %}
{% load static %}
{% load extra_tags %}

{% block extra_css %}
{% endblock extra_css %}

{% block hero_section %}
    <h1 class="text-white">UNIT: <b>{{ unit.name }}</b></h1>
    <div class="mt-3">
        <button type="button" class="btn btn-primary mr-2 py-2 px-4" data-target="#edit_dialog_modal" data-toggle="modal">Edit Unit</button>
        <button type="button" class="btn btn-danger py-2 px-4" data-target="#delete_modal" data-toggle="modal">Delete Unit</button>
    </div>
{% endblock hero_section %}

{% block mode_section %}
    <div class="card-body p-0">
        <div class="row mb-3">
            <div class="col-12">
                <button type="button" class="btn btn-primary mr-2 py-2 px-4" data-target="#add_roles_modal" data-toggle="modal">Add SubUnit</button>
                <button type="button" class="btn text-white btn-primary py-2 px-4 mr-2" data-target="#add_member" data-toggle="modal">Add Member</button>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 col-lg-3">
                <div class="card card-block card-stretch card-height">
                    <div class="card-body">
                        <div class="top-block d-flex align-items-center justify-content-between">
                            <p class="card-text"><small>Unit Members</small></p>
                            <span class="badge badge-warning">Anual</span>
                        </div>
                        <h3>{{ unit.members.count }}</h3>
                    </div>
                </div>
            </div>

            <div class="col-md-6 col-lg-3">
            <div class="card card-block card-stretch card-height">
                <div class="card-body">
                    <div class="top-block d-flex align-items-center justify-content-between">
                        <p class="card-text"><small>Sub Units</small></p>
                        <span class="badge badge-warning">Anual</span>
                    </div>
                    <h3>Coming Soon...</h3>
                </div>
            </div>
        </div>

            <div class="col-md-6 col-lg-3">
                <div class="card card-block card-stretch card-height">
                    <div class="card-body">
                        <div class="top-block d-flex align-items-center justify-content-between">
                            <p class="card-text"><small>Projects by Unit</small></p>
                            <span class="badge badge-warning">Anual</span>
                        </div>
                        <h3>{{ unit.projects_assigned_to_this_unit.count }}</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

     <ul class="nav nav-tabs" id="myTab-two" role="tablist">
        <li class="nav-item">
           <a class="nav-link active" id="members-tab-two" data-toggle="tab" href="#members-two" role="tab" aria-controls="members" aria-selected="true">Members ({{ unit.members.count }})</a>
        </li>

        <li class="nav-item">
           <a class="nav-link" id="insights-tab-two" data-toggle="tab" href="#insights-two" role="tab" aria-controls="insights" aria-selected="false">Insights</a>
        </li>
     </ul>


     <div class="tab-content" id="myTabContent-1">
        <div class="tab-pane fade show active" id="members-two" role="tabpanel" aria-labelledby="members-tab-two">
           <div class="card-body p-0">
                <div class="row">
                    <div class="col-lg-12 mt-2 mb-3">
                        <h3>Unit Members ({{ unit.members.count }})</h3>
                    </div>
                    <div class="col-lg-8">

                        {% for member in unit.members.all %}
                            <div class="card card-block card-stretch">
                                <div class="card-body">
                                    <div class="top-block d-flex align-items-center justify-content-between">
                                        <h3>{{ member.member_name.get_full_name }}</h3>
                                        <div>
                                            <span class="badge badge-warning">{{ member.get_performance_score }}</span>
                                        </div>
                                    </div>

                                    <div>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail h-3 w-3 mr-1" data-lov-id="src/pages/Unit.tsx:294:34" data-lov-name="Mail" data-component-path="src/pages/Unit.tsx" data-component-line="294" data-component-file="Unit.tsx" data-component-name="Mail" data-component-content="%7B%22className%22%3A%22h-3%20w-3%20mr-1%22%7D"><rect width="20" height="16" x="2" y="4" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg>
                                        <span>{{ member.member_name.email }}</span>
                                    </div>

                                    <div>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar h-3 w-3 mr-1" data-lov-id="src/pages/Unit.tsx:298:34" data-lov-name="Calendar" data-component-path="src/pages/Unit.tsx" data-component-line="298" data-component-file="Unit.tsx" data-component-name="Calendar" data-component-content="%7B%22className%22%3A%22h-3%20w-3%20mr-1%22%7D"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg>
                                        <span>Joined {{ member.date_joined|date:"D d M Y" }}</span>
                                    </div>

                                    <div class="mt-3">
                                        <span class="btn btn-danger" title="Remove {{ member. }} from Unit">Remove</span>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}

                        <div class="card border-light">
                          <div class="card-body">
                              <h4 class="mb-3">Projects by Unit</h4>
                              <table class="table table-striped table-hover">
                                    <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Project Name</th>
                                        <th scope="col">% Completion</th>
                                        <th scope="col">No of Target</th>
                                        <th scope="col">Priority</th>
                                        <th scope="col">Status</th>

                                    </tr>
                                    </thead>
                                    <tbody>

                                    {% for project in unit.projects_assigned_to_this_unit.all %}
                                        <tr>
                                            <th scope="row">{{ forloop.counter }}</th>
                                            <td>{{ project.project_name }}</td>
                                            <td>{{ project.get_complete_percentage }}</td>
                                            <td>{{ project.get_no_of_target }}</td>
                                            <td>{{ project.project_priority }}</td>
                                            <td>{{ project.status }}</td>
                                        </tr>
                                    {% empty %}
                                        <td colspan="6"><h5>No current project</h5></td>
                                    {% endfor %}
                                    </tbody>
                                </table>
                          </div>
                        </div>

                    </div>

                    <div class="col-lg-4">
                        <div class="card card-block card-stretch card-height">
                            <div class="card-body">
                                <div class="top-block d-flex align-items-center justify-content-between">
                                    <p class="card-text"><small>Sub Units</small></p>
                                    <span class="badge badge-warning">Anual</span>
                                </div>
                                <h3>Coming Soon...</h3>
                            </div>
                        </div>
                    </div>

                </div>
           </div>
        </div>

        <div class="tab-pane fade" id="insights-two" role="tabpanel" aria-labelledby="insights-tab-two">
           <div class="card col-12 text-center">
                 <div class="card-body mb-3">
                     <p>
                         <svg width="98px" height="98px" viewBox="0 0 14 14" role="img" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path fill="#ffa000" d="M10.67276443 3.58608316H6.12087531L4.98290303 2.44811088h-2.8449307c-.62588475 0-1.13797228.51208753-1.13797228 1.13797228v6.82783368c0 .62588475.51208753 1.13797228 1.13797228 1.13797228h8.81928517c.48363822 0 .85347921-.369841.85347921-.85347921V4.72405544c0-.62588475-.51208753-1.13797228-1.13797228-1.13797228z"></path><path fill="#ffca28" d="M11.86763532 5.29304158H4.21477174c-.54053683 0-1.02417505.3982903-1.10952297.93882713l-.96727644 5.32002041h9.01843032c.54053683 0 1.02417505-.3982903 1.10952297-.93882713L12.9771583 6.630159c.14224653-.68278337-.3982903-1.33711743-1.10952298-1.33711743z"></path></g></svg>
                     </p>
                    <h4 class="card-title">Coming Soon</h4>
                 </div>
            </div>
        </div>
     </div>

{% endblock mode_section %}

{% block modal %}

    <div class="modal fade bd-example-modal-lg" role="dialog" aria-modal="true" id="delete_modal">
        <div class="modal-dialog  modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header d-block text-center pb-3 border-bottom">
                    <h3 class="modal-title" id="delete_modal_title">
                        Delete {{ mode }}
                    </h3>
                </div>
                <div class="modal-body">
                    <form method="post">
                        {% csrf_token %}

                        {% if mode == 'Diakonate' %}
                            <input type="text" name="delete_diaconate" value="{{ diaconate.id }}" style="display: none;">
                            <div class="row">
                                <p class="p-3"><i class="delete_display_text">
                                    Are you sure you want to delete {{ diaconate.name }} Diakonate? This action will
                                    permanently remove the diakonate, all its department, and all associated
                                    data including the members. <span class="text-danger bold">This action is irreversible</span>
                                </i></p>
                            </div>
                        {% elif mode == 'Department' %}
                            <input type="text" name="delete_department" value="{{ department.id }}" style="display: none">
                            <div class="row">
                                <p class="p-3"><i class="delete_display_text">
                                    Are you sure you want to remove {{ department.department_name }} Department from {{ diaconate.name }}?
                                    This action will permanently remove the department, all its units, and all associated
                                    data including the members. <span class="text-danger bold">This action is irreversible</span>
                                </i></p>
                            </div>

                        {% elif mode == 'Unit' %}
                            <div class="row">
                                <input type="text" name="delete_unit" value="{{ unit.id }}" style="display: none">
                                <p class="p-3"><i class="delete_display_text">
                                    Are you sure you want to remove {{ unit.name }} Unit from {{ department.department_name }} . <span class="text-danger bold">This action is irreversible</span>
                                </i></p>
                            </div>
                        {% endif %}

                         <div class="col-lg-12">
                            <div class="d-flex flex-wrap justify-content-end mt-2">
                                <button type="submit" class="btn btn-outline-danger mr-1 pt-2 pb-2">I Understand</button>
                                <div class="btn btn-primary flex-grow-1 pt-2 pb-2" data-dismiss="modal">Cancel</div>
                            </div>
                         </div>

                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg" role="dialog" aria-modal="true" id="edit_dialog_modal">
        <div class="modal-dialog  modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header d-block text-center pb-3 border-bottom">
                    <h3 class="modal-title" id="edit_dialog_modal_title">
                        Edit Unit
                    </h3>
                </div>
                <div class="modal-body">
                    <form method="post">
                        {% csrf_token %}

                        <div class="row" id="unit-section">
                            <div class="col-lg-12" style="display: none;">
                                <input type="text" name="update_unit" value="{{ unit.id }}">
                            </div>

                            <div class="col-lg-12">
                                <div class="form-group mb-3">
                                    <label for="unit-name" class="h5">Name:</label>
                                    <input type="text" name="unit-name" id="unit-name" value="{{ unit.name }}" class="form-control" placeholder="Enter unit name" required>
                                </div>
                            </div>

                            <div class="col-lg-12">
                                <div class="form-group mb-3">
                                    <label for="unit-objective" class="h5">Objectives:</label>
                                    <textarea name="unit-objective" id="unit-objective" class="form-control" cols="30" rows="10" placeholder="Objective of the unit" required>{{ unit.objective }}</textarea>
                                </div>
                            </div>

                            <div class="col-lg-12">
                                <div class="form-group mb-3">
                                    <label for="unit-head" class="h5">Unit Head:</label>
                                    <select name="unit-head" id="unit-head" class=" custom-control custom-select">
                                        <option value="" selected>Choose Unit Head:</option>
                                        {% for member in unit.unit_department.member_names.all %}
                                            <option value="{{ member.id }}" {% if unit.unit_leader.id == member.id %}selected{% endif %}>{{ member.member_name.get_full_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="col-lg-12">
                                <div class="form-group mb-3">
                                    <label for="unit-head-assistant" class="h5">Unit Head Assistant:</label>
                                    <select name="unit-head-assistant" id="department-head-assistant" class=" custom-control custom-select">
                                        <option value="" disabled selected>Choose Unit Head Assistant:</option>
                                        {% for member in unit.unit_department.member_names.all %}
                                            <option value="{{ member.id }}" {% if unit.sub_leader.id == member.id %}selected{% endif %}>{{ member.member_name.get_full_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>


                            <div class="col-lg-12">
                                <div class="d-flex flex-wrap align-items-center justify-content-end mt-2">
                                    <button type="submit" class="flex-grow-1 btn btn-primary mr-1">Save Changes</button>
                                    <div class="btn btn-outline-light" data-dismiss="modal">Cancel</div>
                                </div>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade bd-example-modal-lg" role="dialog" aria-modal="true" id="add_roles_modal">
        <div class="modal-dialog  modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header d-block text-center pb-3 border-bottom">
                    <h3 class="modal-title" id="add_roles_modal_title">
                        Add SubUnit
                    </h3>
                </div>
                <div class="modal-body">
                    <form method="post">
                        {% csrf_token %}
                        <div class="col-lg-12">
                           <div class="card border-secondary">
                              <div class="card-body text-secondary d-flex justify-content-center align-items-center">
                                 <h4 class="card-title text-secondary">Coming Soon</h4>
                              </div>
                           </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg" role="dialog" aria-modal="true" id="add_member">
        <div class="modal-dialog  modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header d-block text-center pb-3 border-bottom">
                    <h3 class="modal-title" id="add_roles_modal_title">Add Member</h3>
                </div>
                <div class="modal-body">
                    <form method="post">
                        {% csrf_token %}
                        <div class="row" id="member-section">
                            <div class="col-lg-12" style="display: none;">
                                <input type="text" name="add-member" value="">
                            </div>
                            <div class="col-lg-12">
                                <div class="form-group mb-3">
                                    <label for="new-member" class="h5">Full Name:</label>
                                    <select name="new-member" id="new-member" class=" custom-control custom-select" required>
                                        <option value="" disabled selected>Add Member:</option>
                                        {% for member in unit.unit_department.member_names.all %}
                                            {% if member not in unit.get_members_in_this_unit %}
                                                <option value="{{ member.member_name.username }}">
                                                    {{ member.member_name.get_full_name }}
                                                </option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="col-lg-12">
                                <div class="d-flex flex-wrap align-items-center justify-content-end mt-2">
                                    <button type="submit" class="flex-grow-1 btn btn-primary mr-1">Add Member</button>
                                    <div class="btn btn-outline-light" data-dismiss="modal">Cancel</div>
                                </div>
                            </div>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


{% endblock modal %}

{% block extra_js %}
{% endblock extra_js %}
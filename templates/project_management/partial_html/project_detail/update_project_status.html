{% load extra_tags %}

<div class="card border-dark">
  <div class="card-body">
      <h4 class="card-title mb-3">Project Progress</h4>
      <p class="card-text mb-0">Overall Progress</p>
      <div class="progress .target-card" data-target-percentage="{{ object.get_complete_percentage }}" data-target-state="{{ object.status }}">
        <div id="target_progress_bar" class="progress-bar progress-bar-striped progress-bar-animated bg-light" role="progressbar" aria-valuenow="{{ object.get_complete_percentage }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ object.get_complete_percentage }}%">{{ object.get_complete_percentage }}%</div>
      </div>
      <p><small>{{ object.get_completed_targets.count }} of {{ object.get_no_of_target }} target completed</small></p>
  </div>
</div>

<h5 class="mb-3">Tasks</h5>


{% for target in object.target.all %}
    <div class="card border-light {% if target.state == 'Pending Approval' %}shadow-box{% endif %}">

      <div class="card-body justify-content-between">
          <div class="d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-1">{{ target.target_name }}</h5>
              <div class="d-flex">
                  {% if target.state == 'Pending Approval' %}
                      {% if user.is_superuser or user|has_project_management_permission %}
                          <button type="button" class="badge btn-primary badge-pill mr-2"
                                  hx-get="{% url 'project_management:change_target_status' target.id %}?leader_approval=Completed"
                                  hx-target="#manage_target_body"
                                  hx-swap="innerHTML"
                                  hx-indicator="#springBouceLoader"
                          >
                              Approve
                          </button>
                          <button type="button" class="badge btn-danger badge-pill"
                                  hx-get="{% url 'project_management:change_target_status' target.id %}?leader_approval=Not Started"
                                  hx-target="#manage_target_body"
                                  hx-swap="innerHTML"
                                  hx-indicator="#springBouceLoader"
                          >
                              Reject
                          </button>
                      {% endif %}
                  {% else %}
                      <select name="update_target_state" class="form-control form-control-sm" id="update_target_state" data-style="py-0"
                              hx-get="{% url 'project_management:change_target_status' target.id %}"
                              hx-target="#manage_target_body"
                              hx-swap="innerHTML"
                              hx-indicator="#springBouceLoader"
                      >
                          <option value="Not Started" {% if target.state == 'Not Started' %}selected{% endif %}>Not Started</option>
                          <option value="In Progress" {% if target.state == 'In Progress' %}selected{% endif %}>In Progress</option>
                          {% if target.state == 'Completed' %}
                            <option value="Completed" {% if target.state == 'Completed' %}selected{% endif %}>Completed</option>
                          {% else %}
                              <option value="Pending Approval" {% if target.state == 'Pending Approval' %}selected{% endif %}>Pending Approval</option>
                          {% endif %}
                      </select>

                  {% endif %}

              </div>
          </div>
          <div>
              <p class="mb-2">{{ target.target_description }}</p>
              <p class="mb-2"><small>Due: {{ target.due_date }}</small></p>
              <div>
                  <a class="btn btn-primary text-white" class="mr-3"
                         hx-get="{% url 'project_management:change_target_status' target.id %}?delete_target=True"
                         hx-target="#manage_target_body"
                         hx-swap="innerHTML"
                         hx-indicator="#springBouceLoader"

                      >Delete</a>
                      <a class="btn btn-danger text-white" data-target="#delete-target-modal" data-toggle="modal" data-dismiss="modal" onclick="populate_target_edit_modal({{ target.id }}, `{{ target.target_name }}`, `{{ target.target_description }}`, '{{ target.due_date.isoformat }}')">Edit</a>
                  </div>
              </div>
          </div>

      </div>

    </div>
{% endfor %}
<div class="col-lg-12">
    <div class="d-flex flex-wrap align-items-center justify-content-end mt-2">
        <button type="button" class="btn btn-outline-dark mr-1" data-dismiss="modal">Cancel</button>
    </div>
</div>
